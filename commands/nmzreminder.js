const axios = require("axios");
const moment = require("moment-timezone");

module.exports = {
  config: {
    name: "autonamaz",
    aliases: ["prayertime", "namazauto"],
    version: "1.0",
    author: "Tanvir",
    shortDescription: "ржЕржЯрзЛ ржирж╛ржорж╛ржЬ рж░рж┐ржорж╛ржЗржирзНржбрж╛рж░ + ржкрзНрж░рждрж┐ ржШржирзНржЯрж╛рзЯ ржЗрж╕рж▓рж╛ржорж┐ржХ ржжрзЛрзЯрж╛ ржмрж╛ рж╣рж╛ржжрж┐рж╕ ржкрж╛ржарж╛рзЯ",
    longDescription: "ржмрж╛ржВрж▓рж╛ржжрзЗрж╢ рж╕ржорзЯ ржЕржирзБржпрж╛рзЯрзА ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯ ржоржирзЗ ржХрж░рж┐рзЯрзЗ ржжрзЗрзЯ ржПржмржВ ржкрзНрж░рждрж┐ ржШржирзНржЯрж╛рзЯ ржЗрж╕рж▓рж╛ржорж┐ржХ ржмрж╛рж░рзНрждрж╛ ржкрж╛ржарж╛рзЯ",
    category: "islamic",
  },

  onStart: async function ({ api }) {
    const timezone = "Asia/Dhaka";

    // ЁЯУЦ ржЗрж╕рж▓рж╛ржорж┐ржХ ржмрж╛рж░рзНрждрж╛ржЧрзБрж▓рзЛ
    const hadiths = [
      "рж░рж╛рж╕рзВрж▓ я╖║ ржмрж▓рзЗржЫрзЗржи: 'рждрзЛржорж╛ржжрзЗрж░ ржоржзрзНржпрзЗ рж╕рж░рзНржмрзЛрждрзНрждржо рж╕рзЗржЗ ржмрзНржпржХрзНрждрж┐, ржпрзЗ ржХрзБрж░ржЖржи рж╢рж┐ржХрзНрж╖рж╛ ржХрж░рзЗ ржПржмржВ рж╢рж┐ржХрзНрж╖рж╛ ржжрзЗрзЯред' (рж╕рж╣рж┐рж╣ ржмрзБржЦрж╛рж░рж┐)",
      "рж░рж╛рж╕рзВрж▓ я╖║ ржмрж▓рзЗржЫрзЗржи: 'ржпрзЗ ржмрзНржпржХрзНрждрж┐ ржорж┐ржерзНржпрж╛ ржХржерж╛ рждрзНржпрж╛ржЧ ржХрж░рзЗ, ржЖрж▓рзНрж▓рж╛рж╣ рждрж╛рж░ ржЬржирзНржп ржЬрж╛ржирзНржирж╛рждрзЗ ржПржХржЯрж┐ ржкрзНрж░рж╛рж╕рж╛ржж рждрзИрж░рж┐ ржХрж░ржмрзЗржиред' (рждрж┐рж░ржорж┐ржЬрж┐)",
      "ржЖрж▓рзНрж▓рж╛рж╣ ржмрж▓рзЗржи: 'рждрзБржорж┐ ржЖржорж╛ржХрзЗ рж╕рзНржорж░ржг ржХрж░, ржЖржорж┐ржУ рждрзЛржорж╛ржХрзЗ рж╕рзНржорж░ржг ржХрж░ржмред' (рж╕рзВрж░рж╛ ржмрж╛ржХрж╛рж░рж╛ рзи:рззрзлрзи)",
      "рж░рж╛рж╕рзВрж▓ я╖║ ржмрж▓рзЗржЫрзЗржи: 'рждрзЛржорж╛рж░ ржорзБржЦ ржерзЗржХрзЗ ржПржХржЯрж┐ рж╣рж╛рж╕рж┐ ржмрзЗрж░ рж╣ржУрзЯрж╛ржУ рж╕ржжржХрж╛ред' (рждрж┐рж░ржорж┐ржЬрж┐)",
      "рж░рж╛рж╕рзВрж▓ я╖║ ржмрж▓рзЗржЫрзЗржи: 'ржирж┐рж╢рзНржЪрзЯржЗ ржЖржорж▓ржЧрзБрж▓рзЛ ржирж┐рзЯрждрзЗрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржХрж░рзЗред' (рж╕рж╣рж┐рж╣ ржмрзБржЦрж╛рж░рж┐)",
      "рж░рж╛рж╕рзВрж▓ я╖║ ржмрж▓рзЗржЫрзЗржи: 'ржпрзЗ ржмрзНржпржХрзНрждрж┐ ржЕржирзНржпржжрзЗрж░ ржЬржирзНржп ржжрзЛрзЯрж╛ ржХрж░рзЗ, ржлрзЗрж░рзЗрж╢рждрж╛рж░рж╛ ржмрж▓рзЗ тАФ ржЖржорж┐ржи, рждрзЛржорж╛рж░ ржЬржирзНржпржУ ржПржХржЗ ржжрзЛрзЯрж╛ред' (ржорзБрж╕рж▓рж┐ржо)",
      "ржЖрж▓рзНрж▓рж╛рж╣ ржмрж▓рзЗржи: 'ржирж┐рж╢рзНржЪрзЯржЗ ржзрзИрж░рзНржпрж╢рзАрж▓ржжрзЗрж░ рж╕рж╛ржерзЗржЗ ржЖрж▓рзНрж▓рж╛рж╣ ржЖржЫрзЗржиред' (рж╕рзВрж░рж╛ ржмрж╛ржХрж╛рж░рж╛ рзи:рззрзлрзй)",
    ];

    // ЁЯХР ржкрзНрж░рждрж┐ ржШржирзНржЯрж╛рзЯ ржЗрж╕рж▓рж╛ржорж┐ржХ ржмрж╛рж░рзНрждрж╛ ржкрж╛ржарж╛ржмрзЗ
    setInterval(() => {
      const random = hadiths[Math.floor(Math.random() * hadiths.length)];
      sendToAllThreads(api, `ЁЯХМ *ржЗрж╕рж▓рж╛ржорж┐ржХ ржмрж╛рж░рзНрждрж╛*\n\n${random}\n\nЁЯд▓ ржЖрж▓рзНрж▓рж╛рж╣ ржЖржорж╛ржжрзЗрж░ рж╕ржмрж╛ржЗржХрзЗ ржЖржорж▓ ржХрж░рж╛рж░ рждрж╛ржУржлрж┐ржХ ржжрж┐ржиред`);
    }, 60 * 60 * 1000); // ржкрзНрж░рждрж┐ ржШржирзНржЯрж╛рзЯ

    // ЁЯХМ ржирж╛ржорж╛ржЬ рж░рж┐ржорж╛ржЗржирзНржбрж╛рж░ рж╕ржорзЯрж╕рзВржЪрж┐
    const prayerTimes = {
      Fajr: "04:45",
      Dhuhr: "12:05",
      Asr: "15:30",
      Maghrib: "17:45",
      Isha: "19:15",
    };

    // ЁЯФБ ржкрзНрж░рждрж┐ ржорж┐ржирж┐ржЯрзЗ ржЪрзЗржХ ржХрж░ржмрзЗ
    setInterval(async () => {
      const now = moment().tz(timezone).format("HH:mm");
      const currentPrayer = Object.keys(prayerTimes).find((key) => prayerTimes[key] === now);
      if (currentPrayer) {
        const msg = `ЁЯХМ ржПржЦржи ${currentPrayer} ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯ!\n\nтП░ рж╕ржорзЯржГ ${now}\n\nржЖрж▓рзНрж▓рж╛рж╣рж░ рж╕ржирзНрждрзБрж╖рзНржЯрж┐рж░ ржЬржирзНржп ржирж╛ржорж╛ржЬ ржЖржжрж╛рзЯ ржХрж░рзБржи ЁЯд▓`;
        sendToAllThreads(api, msg);
      }
    }, 60 * 1000);
  },
};

// ЁЯФД рж╕ржм ржЧрзНрж░рзБржкрзЗ ржкрж╛ржарж╛ржирзЛрж░ рж╣рзЗрж▓рзНржкрж╛рж░ ржлрж╛ржВрж╢ржи
function sendToAllThreads(api, message) {
  try {
    if (global.allThreadIDs && global.allThreadIDs.length > 0) {
      for (const threadID of global.allThreadIDs) {
        api.sendMessage(message, threadID);
      }
    } else {
      console.log("тЪая╕П ржХрзЛржирзЛ ржЧрзНрж░рзБржк ржЖржЗржбрж┐ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐ред");
    }
  } catch (err) {
    console.error("ржмрж╛рж░рзНрждрж╛ ржкрж╛ржарж╛ржирзЛрж░ рж╕ржорзЯ рждрзНрж░рзБржЯрж┐:", err);
  }
}
