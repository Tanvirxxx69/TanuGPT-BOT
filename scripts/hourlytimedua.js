const axios = require("axios");
const moment = require("moment-timezone");
const fs = require("fs");
const path = require("path");

const duas = [
  "ЁЯд▓ ржЖрж▓рзНрж▓рж╛рж╣рзБржорзНржорж╛ ржЗржирзНржирж┐ ржЖрж╕ржЖрж▓рзБржХрж╛ ржЗрж▓ржорж╛ржи ржирж╛ржлрж┐рзЯрж╛ржЖ, ржУржпрж╝рж╛ рж░рж┐ржпржХрж╛ржи рждржЗрзЯрзНржпрж┐ржмрж╛ржЖ, ржУржпрж╝рж╛ ржЖржорж╛рж▓рж╛ржи ржорзБрждрж╛ржХрж╛ржмрзНржмрж╛рж▓рж╛ржЖред",
  "ЁЯТл ржЖрж▓рзНрж▓рж╛рж╣ ржпрж╛ржХрзЗ ржЪрж╛ржи рждрж╛ржХрзЗ ржЕрж▓рзНржк ржжрж┐рзЯрзЗржУ рждрзБрж╖рзНржЯ рж░рж╛ржЦрзЗржи, ржЖрж░ ржпрж╛ржХрзЗ ржЪрж╛ржи рждрж╛ржХрзЗ ржмрзЗрж╢рж┐ ржжрж┐рзЯрзЗржУ ржЕрж╢рж╛ржирзНржд рж░рж╛ржЦрзЗржиред",
  "ЁЯМ┐ ржжрзБржирж┐рзЯрж╛рж░ ржЭрж╛ржорзЗрж▓рж╛рзЯ ржирзЯ, ржЖржЦрж┐рж░рж╛рждрзЗрж░ ржкрзНрж░рж╕рзНрждрзБрждрж┐рждрзЗ ржоржирзЛржпрзЛржЧ ржжрж╛ржУред",
  "ЁЯХКя╕П ржЖрж▓рзНрж▓рж╛рж╣рж░ рж╕рзНржорж░ржгржЗ рж╣рзГржжрзЯрзЗрж░ ржкрзНрж░рж╢рж╛ржирзНрждрж┐ ржжрзЗрзЯ тАФ тАШржЕрж▓рж╛ ржмрж┐ржЭрж┐ржХрж░рж┐рж▓рзНрж▓рж╛рж╣рж┐ рждрж╛рждржорж╛ржЗржирзНржирзБрж▓ ржХрзБрж▓рзБржмтАЩред",
  "ЁЯМ╕ ржирж╛ржорж╛ржЬрзЗрж░ ржорж╛ржзрзНржпржорзЗ ржЖрж▓рзНрж▓рж╛рж╣рж░ ржХрж╛ржЫрзЗ ржжрзЛрзЯрж╛ ржХрж░рзЛ, рждрж┐ржирж┐ржЗ рж╕рж░рзНржмрж╢рзНрж░рзЗрж╖рзНржа рж╢рзНрж░рзЛрждрж╛ред",
  "ЁЯТЦ ржЖрж▓рзНрж▓рж╛рж╣ рждрзЛржорж╛рж░ ржкрзНрж░рждрж┐ ржпрждржЯрж╛ ржжрзЯрж╛рж▓рзБ, ржкрзГржерж┐ржмрзАрж░ ржХрзЗржЙржЗ рждрждржЯрж╛ ржирзЯред",
  "ЁЯХМ ржЖрж▓рзНрж▓рж╛рж╣рж░ ржУржкрж░ ржнрж░рж╕рж╛ рж░рж╛ржЦрзЛ тАФ рждрж┐ржирж┐ рждрзЛржорж╛рж░ ржЬржирзНржп ржпржерзЗрж╖рзНржЯред",
  "ЁЯМЩ рж░рж╛рждрзЗрж░ ржирж┐рж╕рзНрждржмрзНржзрждрж╛рзЯ ржЖрж▓рзНрж▓рж╛рж╣рж░ рж╕рж╛ржоржирзЗ ржорж╛ржерж╛ ржиржд ржХрж░рзЛ, рждрж┐ржирж┐ржЗ рждрзЛржорж╛рж░ ржЕрж╢рзНрж░рзБ ржжрзЗржЦрзЗржиред",
  "ЁЯМ╛ рж░рж┐ржЬрж┐ржХ ржЖрж▓рзНрж▓рж╛рж╣рж░ рж╣рж╛рждрзЗ, рж╢рзБржзрзБ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзЛ тАФ ржирж┐рж░рж╛рж╢ рж╣рзЯрзЛ ржирж╛ред",
  "тЬи ржЖрж▓рзНрж▓рж╛рж╣рж░ ржкржерзЗ ржЪрж▓рж▓рзЗ ржХржЦржирзЛ рж╣рж╛рж░ржмрзЗ ржирж╛ред",
];

module.exports = {
  config: {
    name: "hourlyupdateweatherdua",
    version: "4.0",
    author: "Tanvir",
    shortDescription: "ржмрж╛ржВрж▓рж╛ржжрзЗрж╢ рж╕ржорзЯ, ржЖржмрж╣рж╛ржУрзЯрж╛ ржУ ржЗрж╕рж▓рж╛ржорж┐ржХ ржжрзЛрзЯрж╛ ржкрж╛ржарж╛рзЯ ржкрзНрж░рждрж┐ ржШржирзНржЯрж╛рзЯ",
    longDescription: "ржкрзНрж░рждрж┐ ржШржирзНржЯрж╛рзЯ рж╕ржорзЯ, рждрж╛рж░рж┐ржЦ, ржЖржмрж╣рж╛ржУрзЯрж╛ ржУ рж╕рзБржирзНржжрж░ ржЗрж╕рж▓рж╛ржорж┐ржХ ржжрзЛрзЯрж╛ ржкрж╛ржарж╛рзЯ ржЧрзНрж░рзБржкрзЗ",
    category: "auto",
  },

  onLoad: async function ({ api }) {
    console.log("ЁЯМдя╕П ржкрзНрж░рждрж┐ ржШржирзНржЯрж╛рзЯ рж╕ржорзЯ, ржЖржмрж╣рж╛ржУрзЯрж╛ ржУ ржжрзЛрзЯрж╛ (ржмрж╛ржВрж▓рж╛ржжрзЗрж╢ ржнрж╛рж░рзНрж╕ржи) ржЪрж╛рж▓рзБ рж╣рзЯрзЗржЫрзЗ!");

    setInterval(async () => {
      const now = moment().tz("Asia/Dhaka");
      const time = now.format("hh:mm A");
      const date = now.format("dddd, DD MMMM YYYY");
      const dua = duas[Math.floor(Math.random() * duas.length)];

      const city = "Dhaka"; // ржЪрж╛ржЗрж▓рзЗ ржХрзБржорж┐рж▓рзНрж▓рж╛ ржжрж┐рждрзЗ ржкрж╛рж░рзЛ
      const weatherApi = `https://wttr.in/${city}?format=j1`;

      try {
        const weatherRes = await axios.get(weatherApi);
        const current = weatherRes.data.current_condition[0];
        const temp = current.temp_C;
        const weather = current.weatherDesc[0].value;
        const feelsLike = current.FeelsLikeC;

        const msg = `
ЁЯХТ *${time} | ${date}*
ЁЯМдя╕П ${city}: ${weather}, ${temp}┬░C (ржЕржирзБржнрзВржд ${feelsLike}┬░C)

${dua}
тФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБ
ЁЯдЦ *Tanvir Bot тАФ ржЗрж╕рж▓рж╛ржо ржкрзНрж░ржЪрж╛рж░рзЗ рждрзЛржорж╛рж░ рж╕рж╛ржерзА*
`;

        const threads = await api.getThreadList(100, null, ["INBOX"]);
        for (const thread of threads) {
          if (thread.isGroup && thread.name) {
            api.sendMessage(msg, thread.threadID);
          }
        }
      } catch (err) {
        console.error("тЭМ рж╕ржорзЯ/ржЖржмрж╣рж╛ржУрзЯрж╛ ржкрж╛ржарж╛рждрзЗ рж╕ржорж╕рзНржпрж╛:", err);
      }
    }, 60 * 60 * 1000); // ржкрзНрж░рждрж┐ ржШржирзНржЯрж╛рзЯ ржПржХржмрж╛рж░
  },
};
