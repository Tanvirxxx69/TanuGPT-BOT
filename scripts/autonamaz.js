const moment = require("moment-timezone");

module.exports = {
  config: {
    name: "autonamaz",
    aliases: ["prayertime", "namazauto"],
    version: "2.0",
    author: "Tanvir",
    shortDescription: "ржЕржЯрзЛ ржирж╛ржорж╛ржЬ рж░рж┐ржорж╛ржЗржирзНржбрж╛рж░ (рзл ржУрзЯрж╛ржХрзНржд ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯ ржШрзЛрж╖ржгрж╛ ржжрзЗрзЯ)",
    longDescription: "ржмрж╛ржВрж▓рж╛ржжрзЗрж╢ рж╕ржорзЯ ржЕржирзБржпрж╛рзЯрзА рзл ржУрзЯрж╛ржХрзНржд ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯ ржоржирзЗ ржХрж░рж┐рзЯрзЗ ржжрзЗрзЯ ржПржмржВ рж╕ржм ржЧрзНрж░рзБржкрзЗ ржЕржЯрзЛ ржмрж╛рж░рзНрждрж╛ ржкрж╛ржарж╛рзЯ",
    category: "islamic",
  },

  onStart: async function ({ api }) {
    const timezone = "Asia/Dhaka";

    // ЁЯУЕ ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯрж╕рзВржЪрж┐ (рждрзБржорж┐ ржЪрж╛ржЗрж▓рзЗ ржПржЧрзБрж▓рзЛ ржмржжрж▓рж╛рждрзЗ ржкрж╛рж░рзЛ)
    const prayerTimes = {
      Fajr: "04:45",
      Dhuhr: "12:05",
      Asr: "15:30",
      Maghrib: "17:45",
      Isha: "19:15",
    };

    // ЁЯМЩ ржкрзНрж░рждрж┐ржЯрж┐ ржирж╛ржорж╛ржЬрзЗрж░ ржЬржирзНржп ржЖрж▓рж╛ржжрж╛ ржорзЗрж╕рзЗржЬ
    const prayerMessages = {
      Fajr: [
        "ЁЯМЕ ржлржЬрж░рзЗрж░ рж╕ржорзЯ рж╣рзЯрзЗржЫрзЗ ржнрж╛ржЗ ЁЯМЩ\n\nЁЯХМ ржЙржарзБржи, ржУржпрзБ ржХрж░рзБржи, ржирж╛ржорж╛ржЬ ржЖржжрж╛рзЯ ржХрж░рзБржиред\nржЖрж▓рзНрж▓рж╛рж╣ ржпрзЗржи ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж╛ ржмрж░ржХрждржорзЯ ржХрж░рзЗржи ЁЯд▓",
        "ЁЯХМ *ржлржЬрж░рзЗрж░ рж╕ржорзЯ!* ржЖрж▓рзНрж▓рж╛рж╣рж░ ржбрж╛ржХрзЗ рж╕рж╛рзЬрж╛ ржжрж┐ржи ЁЯМД\nржЖржЬржХрзЗрж░ ржжрж┐ржи рж╢рзБрж░рзБ рж╣рзЛржХ ржирж╛ржорж╛ржЬ ржжрж┐рзЯрзЗред",
      ],
      Dhuhr: [
        "ЁЯМЮ ржпрзЛрж╣рж░рзЗрж░ рж╕ржорзЯ рж╣рзЯрзЗржЫрзЗ!\nржжрзБржирж┐рзЯрж╛рж░ ржХрж╛ржЬ ржПржХржЯрзБ ржерж╛ржорж┐рзЯрзЗ ржирж╛ржорж╛ржЬрзЗ ржЖрж╕рзБржи ЁЯд▓",
        "ЁЯХМ *ржпрзЛрж╣рж░ ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯ!*\nржХрж╛ржЬрзЗрж░ ржмрзНржпрж╕рзНрждрждрж╛ ржмрж╛ржж ржжрж┐ржи, ржЖрж▓рзНрж▓рж╛рж╣рж░ рж╕рзНржорж░ржгрзЗ ржЖрж╕рзБржиред",
      ],
      Asr: [
        "ЁЯМЗ ржЖрж╕рж░рзЗрж░ рж╕ржорзЯ рж╣рзЯрзЗржЫрзЗ!\nржЖрж▓рзНрж▓рж╛рж╣рж░ рж╕ржирзНрждрзБрж╖рзНржЯрж┐рж░ ржЬржирзНржп ржирж╛ржорж╛ржЬ ржЖржжрж╛рзЯ ржХрж░рзБржи ЁЯТЪ",
        "ЁЯХМ *ржЖрж╕рж░рзЗрж░ рж╕ржорзЯ!* ржжрж┐ржирж╢рзЗрж╖рзЗ ржЖржорж▓ ржжрж┐рзЯрзЗ ржмрж░ржХржд ржирж┐ржи тШАя╕П",
      ],
      Maghrib: [
        "ЁЯМЖ ржорж╛ржЧрж░рж┐ржмрзЗрж░ рж╕ржорзЯ рж╣рзЯрзЗржЫрзЗ!\nрж╕ржирзНржзрзНржпрж╛рж░ ржПржЗ ржмрж░ржХрждржорзЯ рж╕ржорзЯрзЗ ржирж╛ржорж╛ржЬрзЗ ржжрж╛рзЬрж╛ржи ЁЯХМ",
        "ЁЯХМ *ржорж╛ржЧрж░рж┐ржмрзЗрж░ ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯ!*\nржЖрж▓рзНрж▓рж╛рж╣рж░ рж░рж╣ржорждрзЗрж░ ржЬржирзНржп ржжрзЛрзЯрж╛ ржХрж░рзБржи ЁЯд▓",
      ],
      Isha: [
        "ЁЯМЩ ржПрж╢рж╛рж░ рж╕ржорзЯ рж╣рзЯрзЗржЫрзЗ!\nржжрж┐ржирзЗрж░ ржХрзНрж▓рж╛ржирзНрждрж┐ ржЭрзЗрзЬрзЗ ржирж╛ржорж╛ржЬрзЗ рж╢рж╛ржирзНрждрж┐ ржЦрзБржБржЬрзБржи ЁЯХМ",
        "ЁЯХМ *ржПрж╢рж╛рж░ рж╕ржорзЯ!*\nржирж╛ржорж╛ржЬ рж╢рзЗрж╖рзЗ ржжрзЛрзЯрж╛ ржХрж░рзБржи, рж╢рж╛ржирзНрждрж┐рждрзЗ ржШрзБржорж╛ржи ЁЯММ",
      ],
    };

    // ЁЯФБ ржкрзНрж░рждрж┐ ржорж┐ржирж┐ржЯрзЗ рж╕ржорзЯ ржЪрзЗржХ ржХрж░ржмрзЗ
    setInterval(() => {
      const now = moment().tz(timezone).format("HH:mm");
      const currentPrayer = Object.keys(prayerTimes).find((key) => prayerTimes[key] === now);

      if (currentPrayer) {
        const msgList = prayerMessages[currentPrayer];
        const message = msgList[Math.floor(Math.random() * msgList.length)];
        sendToAllThreads(api, message);
      }
    }, 60 * 1000); // ржкрзНрж░рждрж┐ рзз ржорж┐ржирж┐ржЯрзЗ ржЪрзЗржХ ржХрж░ржмрзЗ

    console.log("ЁЯХМ Auto Namaz Reminder ржЪрж▓ржЫрзЗ...");
  },
};

// ЁЯФД рж╕ржм ржЧрзНрж░рзБржкрзЗ ржмрж╛рж░рзНрждрж╛ ржкрж╛ржарж╛ржирзЛрж░ ржлрж╛ржВрж╢ржи
function sendToAllThreads(api, message) {
  try {
    if (global.allThreadIDs && global.allThreadIDs.length > 0) {
      for (const threadID of global.allThreadIDs) {
        api.sendMessage(message, threadID);
      }
    } else {
      console.log("тЪая╕П ржХрзЛржирзЛ ржЧрзНрж░рзБржк ржЖржЗржбрж┐ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐ред");
    }
  } catch (err) {
    console.error("тЭМ ржмрж╛рж░рзНрждрж╛ ржкрж╛ржарж╛ржирзЛрж░ рж╕ржорзЯ рждрзНрж░рзБржЯрж┐:", err);
  }
}
